name: $(Date:yyyyMMdd).$(Rev:r) # Custom build numbering format

trigger:
  branches:
    include:
      - devops
      - feat/*
  paths:
    exclude:
      - 'apps/boilerplate/*'
      - 'apps/digiroom/*'
      - 'apps/digiroom-cms/*'
      - 'apps/digiroom-new-car-purchase/*'
      - 'apps/digiroom-promo/*'
    include:
      - 'apps/digiroom-news/*'

pool:
  vmImage: ubuntu-latest

jobs:
- job: BuildAndDeploy
  displayName: 'Build and Deploy'
  steps:
  - task: PowerShell@2
    inputs:
      targetType: 'inline'
      script: |
      arguments: 
        npm install
  - task: Docker@2
    inputs:
      containerRegistry: 'Docker hub connection'
      repository: 'digiroom-news'
      command: 'buildAndPush'
      Dockerfile: '$(System.DefaultWorkingDirectory)/apps/digiroom-news/Dockerfile'
    displayName: 'Build and Push Docker Image'